<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<!-- $Id$ -->
<head>
<title>RELAX NG/Schematron Schema for GedML</title>
</head>
<body>
<h1>RELAX NG/Schematron Schema for GedML</h1>
<p>Used in conjunction with other programs, <em>ged.rng</em> can
determine the validity (in the XML sense) of a GEDCOM 5.5 as if it
were an XML file. The file <em>ged.rng</em> contains a RELAX NG
schema of the <a href=
"http://homepages.rootsweb.com/~pmcbride/gedcom/55gctoc.htm">GEDCOM
5.5 standard</a> as it is envisioned by Michael H. Kay's <a href=
"http://homepage.ntlworld.com/michael.h.kay/gedml/">GedML</a>
proposal. It cannot be used to validate the GEDCOM 6.0 XML
standard, the presumed next-generation GEDCOM standard proposed by
the Church of the Latter Day Saints.</p>
<h2>Why RELAX NG/Schematron rather than DTD or W3C XML Schema?</h2>
<p>Although Kay released a <a href=
"http://users.breathe.com/mhkay/gedml/dtd.html">DTD</a> for GEDML
which could be used in a similar way, I chose to implement the
schema in <a href=
"http://www.oasis-open.org/committees/relax-ng/spec-20011203.html">RELAX
NG</a> for several reasons.</p>
<ol>
<li>
<p>DTDs are less precise than RELAX NG and WC3 XML Schema, and the
GEDCOM 5.5 standard (upon which GedML is based) requires more
precision. For instance, Kay's DTD checks the structure of a GedML
XML file, but it does not check if the content is correctly
formatted. DTDs have very limited ways to describe valid content,
while RELAX NG, Schematron, and WC3 XML Schema can describe valid
content.</p>
</li>
<li>
<p>RELAX NG is easier to learn and a more elegant solution to
schemas than the overly complicated, committee designed W3C XML
Schema.</p>
</li>
<li>
<p>RELAX NG gave me a way to handle the mixed content possibilities
inherent in the GedML tree. This was accomplished by embedding
<a href="http://www.schematron.com/">Schematron</a> patterns into
the RELAX NG schema.</p>
</li>
</ol>
<h2>How to Use <em>ged.rng</em></h2>
<p>Validating a GedML document with <em>ged.rng</em> is currently a
complicated process. It requires familiarity with Java, a bit of
programming skills, and some comfortability with a command line
user interface. If I have the time (and/or the desire), I plan to
write a Java application that should simplify the process. I've
released <em>ged.rng</em> because perhaps someone else will do
this.</p>
<p>The instructions below follow several conventions:</p>
<ul>
<li>
<p><em>family.ged</em> represents a GEDCOM 5.5 file</p>
</li>
<li>
<p><em>family.xml</em> stands for the GedML version of
<em>family.ged</em></p>
</li>
<li>
<p>Text sandwiched between &lt; &gt; indicates variables that will
depend upon your runtime environment</p>
</li>
</ul>
<ol>
<li>
<p><b>Convert the GEDCOM 5.5 file to GedML</b></p>
<p>Currently there is no quick and easy way to convert a GEDCOM 5.5
(or a .ged) file into an GedML (or .xml) file. I know of only one
way to accomplish it now (there may be another) and it requires
some programming skills.</p>
<ol>
<li>
<p>Kay has released<a href="#1">1</a> Java source code which, when
used in conjunction with his saxon parser, can perform this
conversion.</p>
<ol>
<li>
<p>Download Kay's <a href=
"http://homepage.ntlworld.com/michael.h.kay/gedml/">source
code</a></p>
</li>
<li>
<p>Compile it using your favorite Java distribution Java compiler -
javac - (Sun's, IBM's, Blackdown's, or Classpath's - I have used
both Sun's and IBM's on GNU/Linux x86/PowerPC).</p>
</li>
<li>
<p>Download Kay's <a href="http://saxon.sourceforge.net/">saxon
parser</a> and install it somewhere on your computer's <span lang=
"en-US">hard drive.</span> I have successfully used Saxon version
6.5.4.</p>
</li>
<li>
<p>Issue the following command on your command line terminal:<br>
<br>
<code>java -cp &lt;path-to-saxon&gt;:&lt;path-to-gedml-classes&gt;
com.icl.saxon.StyleSheet -x GedcomParser family.ged
&lt;path-to-gedml-classes&gt;/GEDCOMtoXML.xsl &gt;
family.xml</code></p>
</li>
</ol>
</li>
<li>
<p>For the courageous, there may be another way to convert a GEDCOM
5.5 file to a GedML file. Danny Ayers has <a href=
"http://dannyayers.com/2002/02/sag/">released</a><a href="#1">2</a>
Java source code called SAG (Simple API for GEDCOM). Although I
have not tested it, the compiled source code is a library of
functions which would facilitate the conversion; the source code
itself does not produce a suitable binary to perform the
conversion. More Java coding skills would be needed.</p>
</li>
</ol>
</li>
<li>
<p><b>Validate the GedML file</b></p>
<p>Validating the XML file with RELAX NG and Schematron is another
complicated affair. The complication arises because for
<em>ged.rng</em> to fully validate your GedML file, it must be used
by a RELAX NG validator and a Schematron validator. (The entire
process is described <a href=
"http://www.xml.com/pub/a/2004/02/11/relaxtron.html?page=5">here</a>,
if you are curious about the gory details). There are a few easy
solutions and a few complicated solutions.</p>
<ol>
<li>
<p>Topologi.com makes available a cost-free trial version of a
graphical program that can perform both the RELAX NG and Schematron
validations. You can download it from <a href=
"http://www.topologi.com/products/validator/index.html">here</a>.<a href="#3">3</a></p>
</li>
<li>
<p>Another way of validating a GedML file with <em>ged.rng</em>,
can be downloaded <a href=
"http://www.topologi.com/public/Schematron.zip">here</a>.<a href=
"#4">4</a> This Java command line program performs both
validations. I have used this program and it works well. The source
code is available in the zip file. (Please note that the error
messages are not very robust. The program tells you were the errors
have occurred by indicating a line number but the rest of the error
message is rather cryptic.)</p>
</li>
<li>
<p>The last method is the most difficult. Performing both the RELAX
NG and the Schematron validations individually.</p>
<ol>
<li>
<p>First validate the GedML file using the RELAX NG schemas</p>
<p>The gold standard for RELAX NG validation is a open source Java
program called jing,<a href="#5">5</a> written by the author of the
RELAX NG standard. This command line Java application can be
downloaded <a href=
"http://www.thaiopensource.com/relaxng/jing.html">here</a>.</p>
<p>To perform the RELAX NG validation, type the following command
in a terminal:<br>
<br>
<code>java -jar &lt;path-to-jing&gt;/jing.jar ged.rng
family.xml</code><br>
<br>
The result with show in the terminal's standard output. jing will
report all the errors it encounters. It won't say exactly what is
wrong, but it will report what lines have errors in them. If jing
reports no errors, your GedML file is valid, both in terms of its
structure and some of its content.</p>
</li>
<li>
<p>Second perform the Schematron validation</p>
<p>The first validation only tests the validity of some of the
content. RELAX NG, by itself, cannot test the mixed-content
inherent in the GEDCOM 5.5 (and GedML) object model. The Schematron
patterns will test the remainder.</p>
<p>Testing the GedML file with <em>ged.rng's</em> Schematron
patterns, normally requires three transformations. Since the
Schematron patterns are embedded inside <em>ged.rng</em>, they
would need to be extracted using the RNG2Schtrn.xsl stylesheet
available <a href=
"http://www.topologi.com/public/Schtrn_XSD/RNG2Schtrn.zip">here</a>.
To use the extracted Schematron patterns, you would need to
transform them using another stylesheet available <a href=
"http://www.ascc.net/xml/schematron/1.5/basic1-5/schematron-basic.xsl">
here</a>. This transformation would yield a file used to transform
your family-gedml.xml file and finally validate it.</p>
<p>Instead, for your convenience, I have included both the
extracted Schematron patterns - <em>ged.sch</em> - and the
validation file - <em>sch-validate-gedml.xsl</em> - with
<em>ged.rng</em>. To finally validate all the remaining content of
your family-gedml.xml file, you will have to apply
<em>sch-validate-gedml.xsl</em> using saxon. Issue the following
command in a terminal:<br>
<br>
<code>&lt;path-to-saxon&gt;/saxon family.xml
sch-validate-gedml.xsl</code><br>
<br>
Saxon will issue error messages if it finds any problems.</p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>My preferred method of validation is a combination of B and C. I
first follow the C.i instructions and validate the GedML file using
jing. This validates the file using only the RELAX NG schema.
(jing, supposedly, can also perform the Schematron validation, but
I haven't manage to get it to work). I next follow the instructions
in B to validate the GedML file using the Schematron patterns,
rather than following the method of C.ii. The error messages
produced using B's method are more verbose than C.ii's. Method B
will also perform the RELAX NG validation, but after it encounters
only one error, it stops checking for other errors. I prefer the
C.i. instructions because it will reveal all the RELAX NG
validation errors.</p>
<h2>Limitations of <em>ged.rng</em> in relation to the GedML
standard</h2>
<ul>
<li>
<p>Kay's GedML standard is not a complete XML replication of the
GEDCOM 5.5 standard. In particular, the GEDCOM 5.5 standard
requires the TRLR tag at the end of a GEDCOM 5.5 file. This tag
indicates the end of the file. Kay's GedML standard does not
include the TRLR because the closed &lt;/GED&gt; tag indicates the
end of the GedML file. <em>ged.rng</em> follows the GedML standard
in this regard and doesn't check for the TRLR tag.</p>
</li>
<li>
<p><em>ged.rng</em> is unable to determine if GEDCOM 5.5's <a href=
"http://homepages.rootsweb.com/~pmcbride/gedcom/55gcch2.htm#DATE_VALUE">
DATE_VALUE</a> has valid content. The possible combinations of
DATE_VALUEs are simply too numerous to handle using RELAX NG or
Schematron alone. Currently, all <em>ged.rng</em> can check is if
the DATE_VALUE data is between 1 and 35 characters.</p>
</li>
<li>
<p><em>ged.rng</em> has limited support for checking the <a href=
"http://homepages.rootsweb.com/~pmcbride/gedcom/55gcch2.htm#DATE_EXACT">
EXACT_DATE</a> GEDCOM 5.5 data. To be specific, it cannot check the
EXACT_DATE values of <a href=
"http://homepages.rootsweb.com/~pmcbride/gedcom/55gcch2.htm#TRANSMISSION_DATE">
TRANSMISSION_DATE</a> and <a href=
"http://homepages.rootsweb.com/~pmcbride/gedcom/55gcch2.htm#CHANGE_DATE_STRUCTURE">
CHANGE_DATE</a>. When it's able to check the the EXACT_DATE value,
it only check the English <a href=
"http://homepages.rootsweb.com/~pmcbride/gedcom/55gcch2.htm#MONTH">MONTH</a>
abbreviations, <span lang="en-US">(i.e.,</span> JAN, FEB, MAR,
etc...).</p>
</li>
<li>
<p>Normally, the regions in the PLAC tag are separated by commas
(i.e., Kansas City, Jackson County, Missouri, USA) or,
alternatively, the delimiter specified in the HEAD.PLAC.FORM tag.
<em>ged.rng</em> does not check if the PLAC data is delimited.</p>
</li>
<li>
<p>The names of individuals in the NAME tag are usually formatted
with backslashes to indicate first and last names (i.e.,
Joseph/Smith/). <em>ged.rng</em>, regrettably, cannot check the
syntax of NAME data.</p>
</li>
<li>
<p>Since there is no way to anticipate user-defined tags,
<em>ged.rng</em> causes the validators to emit errors when they are
encountered. Strictly speaking, while GEDCOM 5.5 discourages
user-defined tags, they are perfectly legal.</p>
</li>
<li>
<p>Currently, <em>ged.rng</em> does not error check the content of
SOURCE_CITATIONs EVEN tag's <a href=
"http://homepages.rootsweb.com/~pmcbride/gedcom/55gcch2.htm#EVENT_TYPE_CITED_FROM">
EVENT_TYPE_CITED_FROM</a>. It also does not error check the content
of SOURCE_RECORDs EVEN tag's <a href=
"http://homepages.rootsweb.com/~pmcbride/gedcom/55gcch2.htm#EVENTS_RECORDED">
EVENTS_RECORDED</a>. In both cases, the GEDCOM 5.5 standard
specified a restricted set of values.</p>
</li>
<li>
<p>The <a href=
"http://homepages.rootsweb.com/~pmcbride/gedcom/55gcch2.htm#AGE_AT_EVENT">
AGE</a> tag permits values such as CHILD, INFANT, STILLBORN, along
with 'y','m','d' which respectively signifying year, month, day.
Following the specification strictly, these value should be
case-insensitive. However, in <em>ged.rng</em> they currently are
case-sensitive, defaulting to the lowercase values</p>
</li>
<li>
<p>Similarly, the <a href=
"http://homepages.rootsweb.com/~pmcbride/gedcom/55gcch2.htm#MONTH">MONTH</a>
values of DATE_EXACT should also be case-insensitive, but in
<em>ged.rng</em>'s currently implementation they are not. The
default are the uppercases values.</p>
</li>
</ul>
<p>Most of the limitations are due to the fact that the data occurs
in mixed-content structures. <em>ged.rng</em> currently relies on
Schematron to check the GedML files mixed content. Unfortunately,
though, Schematron, as far as I know, does not currently support
regex pattern checking, which could easily remove these
limitations. When Schematron and the rest of the world make the
transition to the XPATH/XSLT 2.0 standard, these limitations could
easily be fixed.</p>
<h2>License</h2>
<p>I'm releasing the <em>ged.rng</em>, <em>ged.sch</em>, and
<em>sch-validate-gedml.xsl</em> under the <a href=
"http://www.gnu.org/copyleft/gpl.html">GNU General Public License
Version 2 (GPL)</a>. The full text of this license can be found in
file called "COPYING" included with <em>ged.rng</em></p>
<p>I'm releasing also this README Document under the <a href=
"http://www.gnu.org/licenses/licenses.html#FDL">GNU Free
Documentation License Version 1.2</a>. The full text of this
license is found in the file called "fdl.txt" released with
<em>ged.rng</em></p>
<h2>Copyrights</h2>
<p>Copyright issues have become increasingly important in the
software industry. Releasing <em>ged.rng</em> under the GPL and
this documentation under the FDL means that I retain the copyrights
but permits modifications so long as these follow the above
licenses. In practice this means that the source code will be
freely available, not only in terms of costs, but in terms of
freedom. In its present form, it will always been available for
public usage, review, and modification.</p>
<p>To find out more, read <a href=
"http://www.gnu.org/licenses/licenses.html#WhatIsCopyleft">here</a>.</p>
<p>If copyright considerations are important to you, I have
included the following copyright audit of the tools used to
validate a GEDCOM 5.5 file.</p>
<ol>
<li>
<p><a name="1"></a>Michael K. Hay retains the copyright to the
GedML conversion code. He offers it free of charge but since he has
not licensed under an Open Source license it is not free as in
freedom. Instead, he releases it with the following notice:</p>
<p><code>There are no restrictions on its use, but equally, it is
provided with no warranty or support.</code></p>
</li>
<li>
<p><a name="2"></a>Danny Ayers has released his source code into
the public domain.</p>
</li>
<li>
<p><a name="3"></a>Topologi.com program is a closed source
proprietary program.</p>
</li>
<li>
<p><a name="4"></a>This tool is provided by Topologi.com free of
charge. The source code for this tool has been released, but its
Open Source status is uncertain. The code says that Eddie
Robertsson retains the copyrights and that he releases it as
follows:</p>
<p><code>* You may use and modify this package for any purpose.
Redistribution is permitted, in both source and binary form,
provided that this notice remains intact in all source
distributions of this package.</code></p>
<p>On face value, it is freer that Michael K. Hays "license" which
says nothing about modification, but only usage.</p>
</li>
<li>
<p><a name="5"></a>jing is an Open Source application licensed
under the GPL.</p>
</li>
</ol>
</body>
</html>
