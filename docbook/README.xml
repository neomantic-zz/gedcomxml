<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML//EN" "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd">

<!-- XML file was created by LyX 1.5.5
  See http://www.lyx.org/ for more information -->
<article lang="en_US">
<articleinfo>
<title>RELAX NG/Schematron Schema for GEDCOM 5.5 XML (version 1.0)</title>
<author>
<firstname>Chad</firstname> <surname>Albers</surname></author></articleinfo><sect1>
<title>Background</title>
<para>The Church of the Latter-day Saints' <ulink url="http://homepages.rootsweb.com/~pmcbride/gedcom/55gctoc.htm">GEDCOM 5.5 Standard</ulink> provides a way to format, digitally store, and transfer genealogical data in a standardized, human readable text file. Over the years, new standards, using the <ulink url="http://www.w3.org/XML/">Extensible Markup Language (XML)</ulink>, have been proposed. The web page <ulink url="http://xml.coverpages.org/genealogy.html">here</ulink> provides a list of these proposals.</para>
<para>None of these proposals have gained widespread acceptance, and GEDCOM 5.5 remains the format that nearly all genealogical programs export to and that users still exchange their genealogical data using.</para><sect2>
<title>GEDCOM 5.5 XML</title>
<para>XML proponents can console themselves with the fact that the GEDCOM 5.5 standard bares some resemblance to an XML markup language. Despite its non-standard character set (Ansel), it is human readable text. Like XML elements, it also uses tags to delimit genealogical data; they precede the data. Finally, GEDCOM 5.5 tags can be nested under other tags, resembling the parent and child node trees of XML elements. </para>
<para>Given these similarities, it is easy to envision a one-to-one translation of GEDCOM 5.5 into an XML language. GEDCOM 5.5 tags could be XML elements; XML's greater than &rsquo;&gt;&rsquo; and less than &rsquo;&lt;&rsquo; characters could surround the tags, converting them into elements. Closed elements could delimit genealogical data. To differentiate it from other proposals, such an XML markup language could be called &ldquo;GEDCOM 5.5 XML.&rdquo;</para>
<para>Two XML markup languages have come close to describing GEDCOM 5.5 XML: GedML and GeniML.</para></sect2><sect2>
<title>GedML</title>
<para>In 1998, Michael H. Kay <ulink url="http://lists.xml.org/archives/xml-dev/199804/msg00282.html">proposed</ulink> a standard called <ulink url="http://homepage.ntlworld.com/michael.h.kay/gedml/">GedML</ulink>. A XML Schema, a DTD, for this proposal has been <ulink url="http://users.breathe.com/mhkay/gedml/dtd.html">released</ulink>. In GedML's DTD, most of the GEDCOM 5.5 tags have been translated into XML elements with the same name; e.g., <literal>INDI</literal> tags are simply <literal>&lt;INDI&gt;</literal> elements. Other tags, though, have been translated; e.g., <literal>SOUR</literal> tags are <literal>&lt;Source&gt;</literal> elements. GedML is also missing the <literal>&lt;TRLR&gt;</literal> element which replicates the GEDCOM 5.5 <literal>TRLR</literal> tag. This tag indicates the end of a GEDCOM 5.5 file. It is absent from GedML because the closed document root element performs the same function, rendering a <literal>&lt;TRLR/&gt;</literal> element superfluous. Considering these differences, as far as the DTD is concerned, GedML is not a one-to-one translation of GEDCOM 5.5 into XML.</para>
<para>Kay, however, also released a Java language program that translates GEDCOM 5.5 files into XML documents. The markup language of these documents does not have a XML schema (DTD, W3C XML Schema, etc.) However, a review of the output of his program reveals that all GEDCOM 5.5 tags have been translated to XML elements with the same name, just like GEDCOM 5.5 XML. There is, though, one missing element: the one corresponding to the <literal>TRLR</literal> tag. Given this flaw, this version of GedML also fails to be a one-to-one translation of GEDCOM 5.5 into XML.</para></sect2><sect2>
<title>GeniML</title>
<para>Jerry Fitzpatrick of Software Renovation Corporation developed <ulink url="http://www.softwarerenovation.com/igenie/GeniML.aspx">GeniML</ulink>. Like Kay, he released a <ulink url="http://www.softwarerenovation.com/igenie/GeniMLConverter.zip">program</ulink> to convert GEDCOM 5.5 to XML. No schema for this markup language has been released. However, sample output of the programe included with the converter shows that GeniML appears to be a one-to-one translation of GEDCOM 5.5 into XML. GeniML even includes the <literal>&lt;TRLR&gt;</literal> element. There are, however, some differences; for example, GeniML delimits surname data using a <literal>&lt;SURNAME&gt;</literal> element, when GEDCOM 5.5 uses a <literal>SURN</literal> tag for the same purpose. Considering this difference and many others, GeniML, like GedML, is not a one-to-one translation of GEDCOM 5.5 into XML markup. </para></sect2></sect1><sect1>
<title>RELAX NG/Schematron Schema for GEDCOM 5.5 XML</title>
<para>GEDCOM 5.5 XML differentiates itself from GedML and GeniML because it attempts to replicate the LDS's GEDCOM 5.5 standard using XML markup. Without exception, all GEDCOM 5.5 tags should correspond to XML elements with the same name; all tags should be preserved; the parent-child relationships between the tags and elements should parallel each other; and all data delimited by the elements should fall within the strict guidelines of the standard.</para>
<para>To define GEDCOM 5.5 XML, a schema is needed. To fulfill that need, I have written one in <ulink url="http://www.oasis-open.org/committees/relax-ng/spec-20011203.html">RELAX NG</ulink>/<ulink url="http://www.schematron.com/">Schematron</ulink>. The XML version of the schema is contained in the file called &ldquo;<filename>gedcom55XML.rng</filename>&rdquo;. The compact syntax version is in the file called &ldquo;<filename>gedcom55XML.rnc</filename>&rdquo;.</para>
<para>Like any schema, it can be used to validate, in the XML sense, a GEDCOM 5.5 file that has been converted to a GEDCOM 5.5 XML document; i.e., it can be used to determine if the document is both &ldquo;wellformed&rdquo; and &ldquo;valid.&rdquo; This means that it can be used to test if the GEDCOM 5.5 tags (when converted to XML elements) are correctly nested within each other as prescribed by the LDS's GEDCOM 5.5 standard. It can also be used to test if the data delimited by the elements follows the strict guidelines prescribed by the standard.</para><sect2>
<title>GEDCOM 5.5 XML URI</title>
<para><literal>http://www.neomantic.com/gedcom55XML</literal>is the namespace for the root element of a GEDCOM 5.5 XML document.</para></sect2><sect2>
<title>Schema Versions and Location</title>
<para>The schema described in this document is version 1.0. It was originally written in RELAX NG's XML markup. The 1.0 XML version is located at <literal><ulink url="http://www.neomantic.com/gedcom55XML/1.0/gedcom55XML.rng">http://www.neomantic.com/gedcom55XML/1.0/gedcom55XML.rng</ulink></literal>. A RELAX NG <ulink url="http://relaxng.org/compact-20021121.html">compact syntax</ulink> version, produced using the XML translator called <literal><ulink url="http://www.thaiopensource.com/relaxng/trang.html">trang</ulink></literal>, is also being released. It is located at <literal><ulink url="http://www.neomantic.com/gedcom55XML/1.0/gedcom55XML.rnc">http://www.neomantic.com/gedcom55XML/1.0/gedcom55XML.rnc</ulink></literal>. (The compact syntax version has not been tested.) Both the XML and compact syntax versions of the 1.0 schema can also be found bundled with this documentation at <ulink url="http://www.neomantic.com/gedcom5.5XML/1.0/gedcom55XML-1.0.tar.gz">http://www.neomantic.com/gedcom5.5XML/1.0/gedcom55XML-1.0.tar.gz</ulink>. For verification purposes, I have signed this tar, gzipped archive with my <ulink url="gnupg"></ulink> public key located <ulink url="http://www.neomantic.com/gnupg/pubkey.asc">here</ulink>. The signature of <filename>gedcom55XML-1.0.tar.gz</filename>is located at <ulink url="http://www.neomantic.com/gedcom55XML/1.0/gedcom55XML-1.0.tar.gz.sign">http://www.neomantic.com/gedcom55XML/1.0/gedcom55XML-1.0.tar.gz.sign</ulink>.</para></sect2><sect2>
<title>Schema License</title>
<para>The source code for both <filename>gedcom55XML.rng</filename> and <filename>gedcom55XML.rnc</filename> is released under the <ulink url="http://www.gnu.org/licenses/old-licenses/gpl-2.0.html">GNU General Public License Version 2</ulink> (GPL). The full text of this license can be found in a file called &ldquo;<filename>gpl-2.0</filename>&rdquo; included with <filename>gedcom55XML.rng</filename>.</para></sect2><sect2>
<title>Schema Updates</title>
<para>Links to the most up to date version of the schema will be located at <ulink url="http://www.neomantic.com/gedcom55XML">http://www.neomantic.com/gedcom55XML</ulink>.</para></sect2><sect2>
<title>Limitations of <filename>gedcom55XML.rng</filename></title>
<para>Ideally, the GEDCOM 5.5 XML RELAX NG/Schematron schema in <filename>gedcom55XML.rng</filename> would completely mirror the GEDCOM 5.5 standard. There are, however, nine places where it does not fully replicate the standard - most of which are due to difficulties in describing what would be considered, in XML terms, mixed-content elements. </para><orderedlist>
<listitem><para><filename>gedcom55XML.rng</filename> does not describe valid content of a GEDCOM 5.5 <literal>DATE_VALUE</literal>. The possible combinations of <literal>DATE_VALUE</literal>s are simply too numerous to handle using Schematron alone. <filename>gedcom55XML.rng</filename> only prescribes that the length of character data of a <literal>DATE_VALUE</literal> be between 1 and 35 characters.</para></listitem><listitem><para><filename>gedcom55XML.rng</filename> does not describe all instances of <literal>EXACT_DATE</literal> data. It fails to describe the <literal>EXACT_DATE</literal> values of <literal>TRANSMISSION_DATE</literal> and <literal>CHANGE_DATE</literal>. When the Schematron rule is able to describe the <literal>EXACT_DATE</literal> value, it only uses the English <literal>MONTH</literal> abbreviations; i.e., <literal>JAN</literal>, <literal>FEB</literal>, <literal>MAR</literal>, etc..</para></listitem><listitem><para>Normally, the regions in the <literal>PLAC</literal> tag are separated by commas (e.g., Kansas City, Jackson County, Missouri, USA) or, alternatively, the delimiter specified in the <literal>HEAD.PLAC.FORM</literal> tag. <filename>gedcom55XML.rng</filename> ignores the delimiter of <literal>PLAC</literal> data.</para></listitem><listitem><para>The given name and surname of an individual in the <literal>NAME</literal> tag are usually delimited by forwardslash (e.g., Joseph/Smith/). The Schematron rules do not prescribe this format.</para></listitem><listitem><para>GEDCOM 5.5 allows for user-defined tags, even though it discourages their usage. <filename>gedcom55XML.rng</filename> does not allow user-defined tags.</para></listitem><listitem><para><filename>gedcom55XML.rng</filename> does not describe the content of <literal>SOURCE_CITATION</literal>'s <literal>EVEN</literal> tag's <literal>EVENT_TYPE_CITED_FROM</literal>, even though the GEDCOM 5.5 standard specifies a restricted set of values. </para></listitem><listitem><para>It also does not describe the content of <literal>SOURCE_RECORD</literal>'s <literal>EVEN</literal> tag's <literal>EVENTS_RECORDED</literal>, even though again the GEDCOM 5.5 standard specifies a restricted set of values.</para></listitem><listitem><para>The <literal>AGE</literal> tag permits values such as <literal>CHILD</literal>, <literal>INFANT</literal>, <literal>STILLBORN</literal>, along with '<literal>y</literal>','<literal>m</literal>','<literal>d</literal>' which respectively signify year, month, and day. Following the specification strictly, these values should be case insensitive. In <filename>gedcom55XML.rng</filename>, they are case sensitive, defaulting to the lowercase values.</para></listitem><listitem><para>The <literal>MONTH</literal> values of <literal>DATE_EXACT</literal> should also be case insensitive, but in the current schema they are not. The defaults are the upper-case values.</para></listitem></orderedlist></sect2></sect1><sect1>
<title>Using <filename>gedcom55XML.rng</filename> to Validate a GEDCOM 5.5 XML Document</title>
<para>If a GEDCOM 5.5 file is converted into a GEDCOM 5.5 XML document, the RELAX NG/Schematron schema contained in <filename>gedcom55XML.rng</filename> provides a way to test the validity, as describe above, of the XML document.</para>
<para>The instructions below describe how to do so using several several external programs available on the internet. The instructions follow several conventions: </para><itemizedlist>
<listitem><para><filename>family.ged</filename> represents a GEDCOM 5.5 file.</para></listitem><listitem><para><filename>family.xml</filename> represents the <filename>family.ged</filename> file translated into a GEDCOM 5.5 XML document.</para></listitem><listitem><para>Text sandwiched between brackets [ ] indicates variables that will depend upon your computer's environment.</para></listitem></itemizedlist><para>In rough outline, the process has two steps:</para><orderedlist>
<listitem><para>Convert the GEDCOM 5.5 file to a GEDCOM 5.5 XML document.</para></listitem><listitem><para>Validate the GEDCOM 5.5 XML document using <filename>gedcom55XML.rng</filename>.</para></listitem></orderedlist><sect2>
<title>Convert the GEDCOM 5.5 File to a GEDCOM 5.5 XML Document</title>
<para>Currently there is no quick and easy way to convert a GEDCOM 5.5 (or a .ged) file into an GEDCOM 5.5 XML (or .xml) file. I know of only one way to accomplish it now, and it requires some programming skills. To perform the conversion, you will need to use a Java program released by Michael Kay which, used with his famous <literal>saxon</literal> XML parser, will perform the conversion.</para><orderedlist>
<listitem><para>Download Kay's <ulink url="http://homepage.ntlworld.com/michael.h.kay/gedml/">source code</ulink> and unzip it in a location of your choosing. Remember the path to this location. You will need to know this path in a later step, and it will be referred to using the variable <literal>[path-to-gedml-classes]</literal>.</para></listitem><listitem><para>Find the files called &ldquo;<filename>GedcomParser.java</filename>&rdquo; and &ldquo;<filename>GedcomToXml.xsl</filename>&rdquo; in Kay's source code.</para></listitem><listitem><para>Compile the file <filename>GedcomParser.java</filename> using your favorite Java distribution's compiler - <literal>javac</literal>. This will produce a class file called &ldquo;<filename>GedcomParser.class</filename>&rdquo;. The command is as follows:</para><screen>
<![CDATA[javac GedcomParser.java
]]></screen></listitem><listitem><para>Download Kay's <literal><ulink url="http://saxon.sourceforge.net/">saxon</ulink></literal> parser, install it, and remember its location, which will be referred to below using the <literal>[path-to-saxon]</literal> variable. (It may already be installed on your system; on my Debian GNU/Linux system it was located at <literal>/usr/share/java/saxon.jar</literal>.)</para></listitem><listitem><para>Convert <filename>family.ged</filename> to <filename>family.xml</filename> by issuing the following command in your terminal:</para><screen>
<![CDATA[java -cp [path-to-saxon]/saxon.jar:[path-to-gedml-classes] com.icl.saxon.StyleSheet -x GedcomParser -o family.xml family.ged [path-to-gedml-classes]/GedcomToXml.xsl
]]></screen></listitem><listitem><para>The output of this command, <filename>family.xml</filename>, will be a XML version of <filename>family.ged</filename>. <filename>family.xml</filename> will be a near perfect reproduction of a GEDCOM 5.5 into GEDCOM 5.5 XML. The only problem with the output is that it fails to add the <literal>&lt;TRLR/&gt;</literal> element before the <literal>&lt;/GED&gt;</literal> element at the end of the document. Kay's GedcomParser removes the <literal>&lt;TRLR/&gt;</literal> element, because the parser was intended for a version of GedML.</para></listitem></orderedlist></sect2><sect2>
<title>Validate the GEDCOM 5.5 XML Document </title>
<para>Validating a XML file with a RELAX NG/Schematron schema is a complicated process. The complication arises because, to fully validate your GEDCOM 5.5 XML file using <filename>gedcom55XML.rng</filename>, a RELAX NG validator <emphasis>and</emphasis> a Schematron validator must be used. (The entire process is described <ulink url="http://www.xml.com/pub/a/2004/02/11/relaxtron.html?page=5">here</ulink>). Two methods for validation are described below. </para><sect3>
<title>Method 1 - Simultaneously Validate the XML against RELAX NG and Schematron</title>
<para>One way of validating a GEDCOM 5.5 XML file with <filename>gedcom55XML.rng</filename> is by using <ulink url="http://www.topologi.com">Topologi's</ulink> <ulink url="http://www.topologi.com/public/">Open Source Schematron Java classes</ulink>. Their zip file <ulink url="http://www.topologi.com/public/Schematron.zip">here</ulink> contains all the binaries and scripts needed to validate a XML file with Schematron rules embedded in RELAX NG patterns. To do so, type the following command in the directory called &ldquo;Schematron&rdquo; that is produced after unzipping the downloaded file above:</para><screen>
<![CDATA[java -cp ./Saxon/saxon.jar:./Java/Schematron.jar:./Jing/jing.jar com.topologi.schematron.EmbRNGValidator family.xml gedcom55XML.rng
]]></screen><para>When this command detects errors in <filename>family.xml</filename> using the RELAX NG schema, it stops at the first error and indicates the line it is on. You will need to correct the XML markup of <filename>family.xml</filename> (and the corresponding tags in <filename>family.ged</filename>), and then run the command above again to find the remaining errors using the RELAX NG schema.</para>
<para>After the command above reveals the error checked against the RELAX NG schema, it then proceeds to check the Schematron rules. When it finds an error, it will not tell you which line has a problem, but only the text of the problematic line. </para>
<para>In either the case of RELAX NG errors or Schematron errors, the command does not tell you what exactly is wrong with the line. It is up to you to figure out why the line is incorrect by referring to the LDS's GEDCOM 5.5 standard. </para></sect3><sect3>
<title>Method 2 - Sequentially Validating the XML against RELAX NG and Schematron</title>
<orderedlist>
<listitem><para>Validate the GEDCOM 5.5 XML file using the RELAX NG portion of the schema. </para><para>RELAX NG validation can be performed by an Open Source Java program called &ldquo;<literal>jing</literal>&rdquo;. This command line application can be downloaded <ulink url="http://www.thaiopensource.com/relaxng/jing.html">here</ulink>. <literal>jing</literal> <ulink url="http://www.thaiopensource.com/relaxng/jing-other.html">supposedly</ulink> can validate a XML file against the Schematron rules embedded in the RELAX NG schema. However, I have been unable to get <literal>jing</literal> to recognized the Schematron patterns in <filename>gedcom55XML.rng</filename>.</para>
<para>To perform the RELAX NG validation, type the following command line: </para><screen>
<![CDATA[java -jar [path-to-jing]/jing.jar gedcom55XML.rng family.xml
]]></screen><para>The results will pipe to the terminal's standard output. <literal>jing</literal> will report <emphasis>all</emphasis> the errors that it encounters. It won't say exactly what is wrong, but it will report what lines have errors. If <literal>jing</literal> reports no errors, your GEDCOM 5.5 XML document is valid, both in terms of its structure and most of its content.</para></listitem><listitem><para>Perform the Schematron validation. </para><para>Step one does not test the mixed-content inherent in the GEDCOM 5.5 (and GEDCOM 5.5 XML) object model. To test the mixed-content elements, the XML document must be tested against the Schematron rules in <filename>gedcom55XML.rng</filename>. It takes two steps to do so.</para><orderedlist>
<listitem><para>The Schematron rules must first be extracted from the RELAX NG schema using the style sheet, <filename>RNG2Schtrn.xsl</filename>, available <ulink url="http://www.topologi.com/public/Schtrn_XSD/RNG2Schtrn.zip">here</ulink>. For the sake of convenience, I have extracted the Schematron rules from <filename>gedcom55XML.rng</filename>. They are in the file called &ldquo;<filename>gedcom55XML.sch</filename>&rdquo;. I'm distributing this source code under the GNU General Public License Version 2. </para></listitem><listitem><para>The <filename>family.xml</filename> file must be passed through the Schematron rules. To do so, we will use Topologoi's Schematron Java classes again, the same ones used in Method 1 above. Go to the &ldquo;Schematron&rdquo; directory again and type the following command:</para><screen>
<![CDATA[java -cp ./Saxon/saxon.jar:./Java/Schematron.jar:./Jing/jing.jar com.topologi.schematron.SchtrnValidator family.xml gedcom55XML.sch
]]></screen></listitem></orderedlist><para>If this command reveals any errors in <filename>family.xml</filename>, it will not tell you the line it occurs on, but it will indicate the data that fails to pass the Schematron rules.</para></listitem></orderedlist></sect3></sect2></sect1><sect1>
<title>Documentation License</title>
<para>This document is released under the <ulink url="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation License Version 1.2</ulink>. The full text of this license is found in the file called &ldquo;<filename>fdl.txt</filename>&rdquo; released with <filename>gedcom55XML.rng</filename>. It can also be located at <literal><ulink url="http://www.neomantic.com/gedcom55XML/1.0/README.html">http://www.neomantic.com/gedcom55XML/1.0/README.html</ulink></literal>. </para></sect1><sect1>
<title>Contact</title>
<para>Please direct questions or requests for more information to <email>chad@neomantic.com</email>. Corrections, suggestions, bug reports, and patches are welcome as well.</para>
<date>5/1/2008</date></sect1></article>
